<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ì–ª–æ–±—É—Å –ú–æ–±–∞–π–ª</title>
    <style>
        :root {
            --ios-bg: #F2F2F7;
            --globus-blue: #1E6C93;
            --ios-gray: #8E8E93;
            --card-bg: #FFFFFF;
            --text-color: #000000;
            --divider: #C6C6C8;
        }

        [data-theme="dark"] {
            --ios-bg: #1C1C1E;
            --card-bg: #2C2C2E;
            --text-color: #FFFFFF;
            --ios-gray: #A1A1A6;
            --divider: #3A3A3C;
        }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, sans-serif;
            background-color: var(--ios-bg);
            color: var(--text-color);
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
            transition: background 0.3s;
        }

        header {
            padding-top: env(safe-area-inset-top);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-bottom: 0.5px solid var(--divider);
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 15px;
            height: 44px;
        }

        .header-left { display: flex; align-items: center; gap: 10px; }
        .logo { font-weight: 800; color: var(--globus-blue); font-size: 18px; letter-spacing: -0.5px; }
        .weather-widget { font-size: 14px; font-weight: 500; color: var(--ios-gray); display: flex; align-items: center; gap: 4px; }

        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .search-container { width: 100%; max-width: 450px; position: relative; z-index: 10; }
        
        .filters-container { display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; }
        .filter-chip { padding: 6px 14px; border-radius: 20px; background: var(--card-bg); font-size: 13px; border: 1px solid var(--divider); cursor: pointer; color: var(--text-color); }
        .filter-chip.active { background: var(--globus-blue); color: white; border-color: var(--globus-blue); }

        .search-bar { background: var(--card-bg); border-radius: 14px; display: flex; align-items: center; padding: 8px 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .search-bar input { flex: 1; border: none; outline: none; font-size: 17px; padding: 10px; background: transparent; color: inherit; }

        .shortcuts-container { display: flex; justify-content: space-around; width: 100%; margin-top: 25px; gap: 10px; }
        .shortcut-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: var(--text-color); font-size: 11px; width: 70px; }
        .shortcut-icon { width: 50px; height: 50px; background: var(--card-bg); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 6px; overflow: hidden; }
        .shortcut-icon img { width: 30px; height: 30px; }

        .history-dropdown { position: absolute; top: 110%; left: 0; right: 0; background: var(--card-bg); border-radius: 14px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); display: none; flex-direction: column; overflow: hidden; border: 0.5px solid var(--divider); z-index: 100; }
        .history-item { padding: 12px 15px; border-bottom: 0.5px solid var(--divider); font-size: 15px; cursor: pointer; color: var(--text-color); }

        .settings-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 200; }
        .settings-card { background: var(--card-bg); width: 90%; max-width: 380px; border-radius: 20px; padding: 20px; max-height: 85vh; overflow-y: auto; color: var(--text-color); }

        .tab-bar { background: rgba(255,255,255,0.8); backdrop-filter: blur(15px); border-top: 0.5px solid var(--divider); display: flex; justify-content: space-around; padding-bottom: env(safe-area-inset-bottom); height: 70px; }
        .tab-item { display: flex; flex-direction: column; align-items: center; color: var(--ios-gray); text-decoration: none; font-size: 11px; justify-content: center; }
    </style>
</head>
<body data-theme="light">

    <header>
        <div class="header-left">
            <div class="logo">–ì–ª–æ–±—É—Å</div>
            <div class="weather-widget" id="weather">...</div>
        </div>
        <div onclick="toggleSettings()" style="cursor:pointer; font-size: 20px;">‚öôÔ∏è</div>
    </header>

    <main>
        <div class="search-container">
            <div class="filters-container">
                <div class="filter-chip active" id="f-none" onclick="setFilter('none')">–ù–µ—Ç</div>
                <div class="filter-chip" id="f-video" onclick="setFilter('video')">–í–∏–¥–µ–æ</div>
                <div class="filter-chip" id="f-shop" onclick="setFilter('shop')">–ü–æ–∫—É–ø–∫–∏</div>
            </div>

            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –≤ –ì–ª–æ–±—É—Å–µ..." autocomplete="off" onfocus="showHistory()">
                <button class="search-btn" onclick="executeSearch()" style="background: var(--globus-blue); border:none; border-radius:10px; width:40px; height:40px; cursor:pointer;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </button>
            </div>
            
            <div id="historyDropdown" class="history-dropdown">
                <div id="historyList"></div>
                <div style="font-size: 12px; color: var(--globus-blue); text-align: center; padding: 10px; cursor: pointer;" onclick="clearHistory()">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</div>
            </div>

            <div class="shortcuts-container" id="shortcutsDisplay"></div>
            <p id="filterHint" style="text-align:center; font-size:12px; margin-top:15px; color:var(--ios-gray);">–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–π –ó–µ–º–ª–µ</p>
        </div>
    </main>

    <div id="settingsOverlay" class="settings-overlay">
        <div class="settings-card">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <p>–¢–µ–º–∞: <select id="themeSelect"><option value="light">–°–≤–µ—Ç–ª–∞—è</option><option value="dark">–¢—ë–º–Ω–∞—è</option></select></p>
            <p>–í–∏–¥–µ–æ: <select id="videoSource"><option value="youtube">YouTube</option><option value="rutube">RuTube</option><option value="vk">VK</option></select></p>
            <p>–®–æ–ø–∏–Ω–≥: <select id="shopSource"><option value="wb">WB</option><option value="ozon">Ozon</option><option value="olx">OLX</option></select></p>
            <hr>
            <h4>–ú–æ–∏ —è—Ä–ª—ã–∫–∏</h4>
            <input type="text" id="sN1" style="width:70px"> <input type="text" id="sU1" style="width:130px"><br>
            <input type="text" id="sN2" style="width:70px"> <input type="text" id="sU2" style="width:130px"><br>
            <input type="text" id="sN3" style="width:70px"> <input type="text" id="sU3" style="width:130px">
            <button onclick="saveSettings(); toggleSettings();" style="width:100%; padding:12px; margin-top:20px; border-radius:10px; background:var(--globus-blue); color:white; border:none;">–ì–æ—Ç–æ–≤–æ</button>
        </div>
    </div>

    <nav class="tab-bar">
        <a href="" class="tab-item active">üîç<span>–ü–æ–∏—Å–∫</span></a>
        <a href="https://vadimpapin188.github.io/globus" class="tab-item">üåê<span>–°–∞–π—Ç</span></a>
    </nav>

    <script>
        let currentFilter = 'none';

        // --- –ü–û–ì–û–î–ê ---
        async function getWeather() {
            try {
                // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ü–∞–≤–ª–æ–¥–∞—Ä–∞
                const lat = 52.28;
                const lon = 76.96;
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await response.json();
                const temp = Math.round(data.current_weather.temperature);
                const code = data.current_weather.weathercode;
                
                let icon = "‚òÄÔ∏è";
                if (code >= 1 && code <= 3) icon = "‚õÖ";
                if (code >= 45 && code <= 48) icon = "üå´Ô∏è";
                if (code >= 51 && code <= 67) icon = "üåßÔ∏è";
                if (code >= 71 && code <= 77) icon = "üå®Ô∏è";
                if (code >= 80) icon = "‚õàÔ∏è";

                document.getElementById('weather').innerHTML = `${icon} ${temp}¬∞C`;
            } catch (e) {
                document.getElementById('weather').innerHTML = "‚òÅÔ∏è 0¬∞C";
            }
        }

        // --- –û–°–¢–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê ---
        function setFilter(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            document.getElementById('f-' + type).classList.add('active');
            const hints = { 'none': '–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–π –ó–µ–º–ª–µ', 'video': '–ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ–∫–æ–Ω—Ç–µ–Ω—Ç–∞', 'shop': '–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤' };
            document.getElementById('filterHint').innerText = hints[type];
        }

        function saveToHistory(q) {
            let h = JSON.parse(localStorage.getItem('globus_history') || '[]');
            if (!h.includes(q)) { h.unshift(q); if (h.length > 5) h.pop(); localStorage.setItem('globus_history', JSON.stringify(h)); }
        }

        function showHistory() {
            const h = JSON.parse(localStorage.getItem('globus_history') || '[]');
            if (h.length > 0) {
                document.getElementById('historyList').innerHTML = h.map(q => `<div class="history-item" onclick="selectHistory('${q}')">üïí ${q}</div>`).join('');
                document.getElementById('historyDropdown').style.display = 'flex';
            }
        }
        function selectHistory(q) { document.getElementById('searchInput').value = q; executeSearch(); }
        function clearHistory() { localStorage.removeItem('globus_history'); document.getElementById('historyDropdown').style.display = 'none'; }

        function toggleSettings() {
            const s = document.getElementById('settingsOverlay');
            s.style.display = (s.style.display === 'flex') ? 'none' : 'flex';
        }

        function saveSettings() {
            localStorage.setItem('globus_theme', document.getElementById('themeSelect').value);
            localStorage.setItem('globus_video', document.getElementById('videoSource').value);
            localStorage.setItem('globus_shop', document.getElementById('shopSource').value);
            const shorts = [
                { name: document.getElementById('sN1').value, url: document.getElementById('sU1').value },
                { name: document.getElementById('sN2').value, url: document.getElementById('sU2').value },
                { name: document.getElementById('sN3').value, url: document.getElementById('sU3').value }
            ];
            localStorage.setItem('globus_shorts', JSON.stringify(shorts));
            applyAll();
        }

        function applyAll() {
            const theme = localStorage.getItem('globus_theme') || 'light';
            document.body.setAttribute('data-theme', theme);
            document.getElementById('themeSelect').value = theme;
            document.getElementById('videoSource').value = localStorage.getItem('globus_video') || 'youtube';
            document.getElementById('shopSource').value = localStorage.getItem('globus_shop') || 'wb';

            const shorts = JSON.parse(localStorage.getItem('globus_shorts') || '[{"name":"YouTube","url":"https://youtube.com"},{"name":"Ozon","url":"https://ozon.ru"},{"name":"VK","url":"https://vk.com"}]');
            document.getElementById('shortcutsDisplay').innerHTML = shorts.map(s => `
                <a href="${s.url}" class="shortcut-item">
                    <div class="shortcut-icon"><img src="https://www.google.com/s2/favicons?domain=${s.url}&sz=64"></div>
                    <span>${s.name}</span>
                </a>
            `).join('');
            shorts.forEach((s, i) => {
                document.getElementById('sN' + (i+1)).value = s.name;
                document.getElementById('sU' + (i+1)).value = s.url;
            });
        }

        function executeSearch() {
            const rawQuery = document.getElementById('searchInput').value.trim();
            if (!rawQuery) return;
            saveToHistory(rawQuery);
            const query = rawQuery.toLowerCase().replace(/ /g, '-');
            const v = localStorage.getItem('globus_video') || 'youtube';
            const s = localStorage.getItem('globus_shop') || 'wb';
            let url = "https://sites.google.com/view/globushomett/" + encodeURIComponent(query);
            if (currentFilter === 'video') {
                if(v === 'youtube') url = `https://www.youtube.com/results?search_query=${rawQuery}`;
                if(v === 'rutube') url = `https://rutube.ru/search/?query=${rawQuery}`;
                if(v === 'vk') url = `https://vk.com/video?q=${rawQuery}`;
            } else if (currentFilter === 'shop') {
                if(s === 'wb') url = `https://www.wildberries.ru/catalog/0/search.aspx?search=${rawQuery}`;
                if(s === 'ozon') url = `https://www.ozon.ru/search/?text=${rawQuery}`;
                if(s === 'olx') url = `https://www.olx.kz/list/q-${rawQuery}/`;
            }
            window.location.href = url;
        }

        document.addEventListener('click', (e) => { if (!e.target.closest('.search-container')) document.getElementById('historyDropdown').style.display = 'none'; });
        document.getElementById("searchInput").addEventListener("keyup", (e) => { if (e.key === "Enter") executeSearch(); });
        
        applyAll();
        getWeather();
    </script>
</body>
</html>
