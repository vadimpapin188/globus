<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Глобус - Поиск и не только!</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <style>
    :root {
      --primary-color: #C0C0C0; 
      --secondary-color: #ffffff;
      --background-color: #051937; 
      --sidebar-bg: #1a2a3a;
      --sidebar-width: 200px;
    }
    body { margin: 0; font-family: Arial, sans-serif; background-color: var(--background-color); color: var(--secondary-color); display: flex; min-height: 100vh; overflow-x: hidden; }
    
    /* Снежинки */
    .snowflake { color: #fff; font-size: 1em; position: fixed; top: -10%; z-index: 9999; animation: snowflakes-fall 10s linear infinite; }
    @keyframes snowflakes-fall { 0% { top: -10%; } 100% { top: 100%; } }

    nav.sidebar { width: var(--sidebar-width); background-color: var(--sidebar-bg); color: white; position: fixed; height: 100%; padding-top: 10px; box-sizing: border-box; z-index: 100; transition: width 0.3s; }
    nav.sidebar.collapsed { width: 50px; }
    nav.sidebar ul { list-style-type: none; padding: 0; margin: 0; }
    nav.sidebar ul li a { color: white; padding: 10px; display: block; text-decoration: none; white-space: nowrap; overflow: hidden; font-size: 14px; }
    nav.sidebar ul li a:hover { background-color: var(--primary-color); }
    
    #menu-toggle { position: absolute; top: 5px; right: -25px; background-color: var(--primary-color); color: white; border: none; padding: 5px 8px; cursor: pointer; border-radius: 5px; font-size: 12px; }
    
    .content-area { flex-grow: 1; margin-left: var(--sidebar-width); display: flex; flex-direction: column; transition: margin-left 0.3s; }
    .content-area.shifted { margin-left: 50px; }
    
    .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background-color: rgba(255, 255, 255, 0.05); }
    .brand-section h1 { color: var(--primary-color); font-size: 40px; margin: 0; }
    
    .search-section { display: flex; gap: 10px; }
    #search-input { padding: 10px 15px; border: 1px solid #aaa; width: 300px; border-radius: 4px; }
    #search-button { padding: 10px 20px; background-color: var(--primary-color); color: white; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; }
    
    main { padding: 40px; flex-grow: 1; z-index: 10; }
    footer { text-align: center; padding: 15px; background-color: #222; color: #888; font-size: 12px; }

    /* --- НОВЫЕ СТИЛИ ДЛЯ РЕКОМЕНДАЦИЙ --- */
    .recommended-sites { margin-bottom: 30px; }
    .recommended-sites h2 { font-size: 24px; color: var(--primary-color); margin-bottom: 15px; }
    .sites-list { display: flex; gap: 15px; flex-wrap: wrap; }
    .site-link { 
        background: rgba(255, 255, 255, 0.1); 
        color: white; 
        padding: 10px 20px; 
        border-radius: 20px; 
        text-decoration: none; 
        border: 1px solid var(--primary-color);
        transition: 0.3s;
        font-size: 14px;
    }
    .site-link:hover { 
        background: var(--primary-color); 
        color: var(--background-color); 
    }
    /* ------------------------------------ */
    
    .ai-answer-box { background: rgba(255,255,255,0.1); padding: 25px; border-radius: 12px; color: white; line-height: 1.6; font-size: 18px; border-left: 5px solid var(--primary-color); margin-top: 20px; }
    .shop-btn { padding: 15px 25px; margin-top: 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; margin-right: 10px; }
    .wb { background: #8d169b; }
    .dm { background: #0056b3; }
  </style>
</head>
<body>
  <nav class="sidebar" id="sidebar">
    <button id="menu-toggle">«</button>
    <ul>
      <li><a href="https://vadimpapin188.github.io/globus"><span>Главная (вы тут)</span></a></li>
      <li><a href="#"><span>О нас</span></a></li>
      <li><a href="#"><span>Новое</span></a></li>
      <li><a href="https://vadimpapin188.github.io/globus-news/"><span>Новости</span></a></li>
    </ul>
  </nav>

  <div class="content-area" id="content-area">
    <div class="top-bar">
      <div class="brand-section"><h1>Глобус</h1></div>
      <div class="search-section">
        <input id="search-input" type="text" placeholder="...и по галактике найдём!">
        <button id="search-button">Найти</button>
      </div>
    </div>

    <main id="main">
      <div class="recommended-sites">
        <h2>Рекомендуемые сайты</h2>
        <div class="sites-list">
          <a href="https://topiq.kz/ru/" target="_blank" class="site-link">TopiQ</a>
          <a href="https://portal.kundelik.kz/ru/v2" target="_blank" class="site-link">Кунделик</a>
          <a href="https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0" target="_blank" class="site-link">Википедия</a>
           <a href="news.html" target="_blank" class="site-link">Глобус Новости</a>
           <a href="https://scratch.mit.edu/" target="_blank" class="site-link">Скретч</a>
        </div>
      </div>
      <p>Найдём по всей земле и за её пределами!</p>
    </main>

    <footer>© Глобус. 2025.</footer>
  </div>

  <script>
    // Твой JavaScript остается без изменений, он будет работать правильно
    const input = document.getElementById('search-input');
    const button = document.getElementById('search-button');
    const mainArea = document.getElementById('main');
    const sidebar = document.getElementById('sidebar');
    const toggleButton = document.getElementById('menu-toggle');
    const contentArea = document.getElementById('content-area');

    const aiTriggers = ["как", "что", "почему", "зачем", "кто", "где", "когда", "какой"];

    function createSnow() {
        const snowflake = document.createElement('div');
        snowflake.classList.add('snowflake');
        snowflake.innerHTML = '❄';
        snowflake.style.left = Math.random() * 100 + 'vw';
        snowflake.style.animationDuration = Math.random() * 3 + 7 + 's';
        snowflake.style.opacity = Math.random();
        document.body.appendChild(snowflake);
        setTimeout(() => { snowflake.remove(); }, 10000);
    }
    setInterval(createSnow, 400);

    async function fixOrtho(query) {
        try {
            const response = await fetch(`https://speller.yandex.net/services/spellservice.json/checkText?text=${encodeURIComponent(query)}`);
            const data = await response.json();
            let correctedQuery = query;
            for (let i = data.length - 1; i >= 0; i--) {
                const error = data[i];
                if (error.s && error.s.length > 0) {
                    correctedQuery = correctedQuery.substring(0, error.pos) + error.s[0] + correctedQuery.substring(error.pos + error.len);
                }
            }
            return correctedQuery;
        } catch (e) { return query; }
    }

    async function askAI(question) {
        mainArea.innerHTML = "<h2>Глобус Ассистент</h2><p>Думаю над ответом...</p>";
        try {
            const aiResponse = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    "model": "mistralai/mistral-7b-instruct:free",
                    "messages": [
                        {"role": "user", "content": question}
                    ]
                })
            });
            const data = await aiResponse.json();
            const aiAnswer = data.choices[0].message.content;
            mainArea.innerHTML = `<div class="ai-answer-box">${aiAnswer.trim().replace(/\n/g, '<br>')}</div>`;
        } catch (error) {
            mainArea.innerHTML = `<h2>Ошибка</h2><button class="shop-btn dm" onclick="window.location.href='https://www.google.com/search?q=${question}'">Перейти в Google</button>`;
        }
    }

    async function search() {
        let rawQuery = input.value.trim();
        if (!rawQuery) return alert('Введите запрос!');
        
        button.disabled = true;
        button.textContent = '...';
        
        let finalQuery = await fixOrtho(rawQuery);
        finalQuery = finalQuery.toLowerCase();
        finalQuery = finalQuery.replace(/[^\w\sа-яё0-9]/gi, '');
        input.value = finalQuery;
        
        let firstWord = finalQuery.split(' ')[0];

        if (aiTriggers.includes(firstWord)) {
            await askAI(finalQuery);
        } else if (finalQuery.includes("одежда")) {
            mainArea.innerHTML = `<h2>Глобус Маркет</h2><button class="shop-btn wb" onclick="window.location.href='https://www.wildberries.ru/catalog/0/search.aspx?search=${finalQuery}'">Wildberries</button><button class="shop-btn dm" onclick="window.location.href='https://www.detmir.ru/search/results/?qt=${finalQuery}'">Детский Мир</button>`;
        } else {
            let slugQuery = finalQuery.replace(/\s+/g, '-');
            window.location.href = 'https://sites.google.com/view/globushomett/' + encodeURIComponent(slugQuery);
        }
        
        button.disabled = false;
        button.textContent = 'Найти';
    }

    button.addEventListener('click', search);
    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') search(); });
    toggleButton.addEventListener('click', () => {
        const isCollapsed = sidebar.classList.toggle('collapsed');
        contentArea.classList.toggle('shifted', isCollapsed);
        toggleButton.textContent = isCollapsed ? '»' : '«';
    });
  </script>
</body>
</html>

